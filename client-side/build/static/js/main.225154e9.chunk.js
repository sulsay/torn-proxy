(this["webpackJsonpclient-side"]=this["webpackJsonpclient-side"]||[]).push([[0],[,,,,function(e,t,n){e.exports={metaRow:"ProxyKey_metaRow__2JeuK",keyRow:"ProxyKey_keyRow__8puyP",permissionsRow:"ProxyKey_permissionsRow__RGH2L",betaPermissions:"ProxyKey_betaPermissions__2e8_X",altRow:"ProxyKey_altRow__1oV-P",revoked:"ProxyKey_revoked__2Rst7",key:"ProxyKey_key__17jyI",revokedAt:"ProxyKey_revokedAt__37SHF",revokeButton:"ProxyKey_revokeButton__1ov-e",reinstateButton:"ProxyKey_reinstateButton__2U8Sf"}},function(e,t,n){e.exports={root:"ProxyKeys_root__3D-FE",lockAnchor:"ProxyKeys_lockAnchor__GIm2o"}},function(e,t,n){e.exports={root:"Faq_root__zfkZZ",question:"Faq_question__1LI2v"}},,,function(e,t,n){e.exports={root:"App_root__3JlSw"}},function(e,t,n){e.exports={wrongKey:"TornKeyForm_wrongKey__s2rQ-"}},function(e,t,n){e.exports=n(18)},,,,,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),s=n.n(o),c=(n(16),n(1)),l=n.n(c),i=n(3),u=n(2),p=n(9),d=n.n(p),m=n(10),y=n.n(m),f=r.a.createContext({serverBaseUrl:"",user:null});f.displayName="AppContext";var k=f,h=function(e){var t=e.onAuthenticated,n=Object(a.useContext)(k),o=Object(a.useState)(""),s=Object(u.a)(o,2),c=s[0],p=s[1],d=Object(a.useState)(!1),m=Object(u.a)(d,2),f=m[0],h=m[1],v=Object(a.useState)(!1),b=Object(u.a)(v,2),E=b[0],x=b[1],w=function(){var e=Object(i.a)(l.a.mark((function e(a){var r,o,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),h(!0),x(!1),e.next=5,fetch(n.serverBaseUrl+"/api/authenticate",{credentials:"include",method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:c})});case 5:if(r=e.sent,h(!1),200!==r.status){e.next=16;break}return e.next=10,r.json();case 10:o=e.sent,s=o.id,i=o.name,t({id:s,name:i}),e.next=17;break;case 16:x(!0);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:w},r.a.createElement("input",{className:E?y.a.wrongKey:"",type:"text",value:c,onChange:function(e){return p(e.target.value)},disabled:f}),r.a.createElement("input",{type:"submit",disabled:f,value:"Unlock"}),f&&r.a.createElement("span",null,"checking..."))},v=n(4),b=n.n(v),E=function(){return{convertKeyRecordToEntity:function(e){return{key:e.key,userId:e.user_id,permissions:e.permissions,description:e.description,createdAt:new Date(e.created_at),revokedAt:e.revoked_at?new Date(e.revoked_at):null}}}},x=function(e){var t=e.keyEntity,n=e.useAltStyle,o=e.onKeyUpdated,s=Object(a.useContext)(k),c=E(),p=Object(a.useState)(!1),d=Object(u.a)(p,2),m=d[0],y=d[1];function f(){return(f=Object(i.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,x({revokedAt:new Date});case 3:n=e.sent,o(n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=Object(i.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,x({revokedAt:null});case 3:n=e.sent,o(n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=Object(i.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x({permissions:t});case 2:n=e.sent,o(n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=Object(i.a)(l.a.mark((function e(n){var a,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},void 0!==n.revokedAt&&(a.revoked_at=(null===(r=n.revokedAt)||void 0===r?void 0:r.toISOString())||null),"string"===typeof n.permissions&&(a.permissions=n.permissions),y(!0),e.next=6,fetch("".concat(s.serverBaseUrl,"/api/keys/").concat(t.key),{method:"put",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 6:return o=e.sent,e.next=9,o.json();case 9:return e.abrupt("return",e.sent.map(c.convertKeyRecordToEntity));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=[n?b.a.altRow:"",t.revokedAt?b.a.revoked:""];return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{className:[].concat(O,[b.a.metaRow]).join(" ")},r.a.createElement("td",null,t.description),r.a.createElement("td",null,r.a.createElement("span",{title:t.createdAt.toString()},t.createdAt.toLocaleDateString())),r.a.createElement("td",null,null===t.revokedAt&&r.a.createElement("button",{className:b.a.revokeButton,onClick:function(e){return f.apply(this,arguments)},disabled:m},"revoke"),null!==t.revokedAt&&r.a.createElement("span",{title:t.revokedAt.toString(),className:b.a.revokedAt},"revoked at ",t.revokedAt.toLocaleDateString()))),r.a.createElement("tr",{className:[].concat(O,[b.a.keyRow]).join(" ")},r.a.createElement("td",{colSpan:t.revokedAt?2:3},r.a.createElement("span",{className:b.a.key+" "+(null!==t.revokedAt?b.a.revoked:"")},t.key)),null!==t.revokedAt&&r.a.createElement("td",null,r.a.createElement("button",{className:b.a.reinstateButton,onClick:function(e){return h.apply(this,arguments)},disabled:m},"reinstate"))),r.a.createElement("tr",{className:[].concat(O,[b.a.permissionsRow]).join(" ")},r.a.createElement("td",{colSpan:3},r.a.createElement("span",{className:b.a.betaPermissions},"BETA permissions:"),Object.entries({"*":"Public+private",public:"Public only"}).map((function(e){var n=Object(u.a)(e,2),a=n[0],o=n[1];return r.a.createElement("label",{key:a},r.a.createElement("input",{disabled:m,type:"radio",name:"permissions-".concat(t.key),value:a,checked:t.permissions===a,onChange:function(){return function(e){return v.apply(this,arguments)}(a)}}),o)})))))},w=n(5),O=n.n(w),_=function(e){var t,n,o=e.onLock,s=Object(a.useContext)(k),c=E(),p=Object(a.useState)(!1),d=Object(u.a)(p,2),m=d[0],y=d[1],f=Object(a.useState)([]),h=Object(u.a)(f,2),v=h[0],b=h[1],w=Object(a.useState)(!1),_=Object(u.a)(w,2),g=_[0],j=_[1],A=Object(a.useState)(""),S=Object(u.a)(A,2),N=S[0],R=S[1],P=Object(a.useState)(!1),I=Object(u.a)(P,2),T=I[0],K=I[1],C=Object(a.useState)(null),B=Object(u.a)(C,2),q=B[0],D=B[1],U=Object(a.useState)(0),F=Object(u.a)(U,2),L=F[0],W=F[1];Object(a.useEffect)((function(){y(!0),Object(i.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(s.serverBaseUrl+"/api/keys",{credentials:"include"});case 2:if(200!==(t=e.sent).status){e.next=10;break}return e.next=6,t.json();case 6:n=e.sent.map(c.convertKeyRecordToEntity),b(n),e.next=18;break;case 10:return e.t0=D,e.next=13,t.json();case 13:if(e.t1=e.sent.error_message,e.t1){e.next=16;break}e.t1="some error";case 16:e.t2=e.t1,(0,e.t0)(e.t2);case 18:y(!1);case 19:case"end":return e.stop()}}),e)})))()}),[]);var J=Object(a.useMemo)((function(){return v.filter((function(e){return null===e.revokedAt}))}),[v]),M=Object(a.useMemo)((function(){return v.filter((function(e){return null!==e.revokedAt}))}),[v]);function H(){return(H=Object(i.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),K(!0),e.next=4,fetch(s.serverBaseUrl+"/api/keys",{credentials:"include",method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:N})});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent.map(c.convertKeyRecordToEntity),b(a),R(""),K(!1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return e.map((function(e,t){return r.a.createElement(x,{key:L+"_"+e.key,keyEntity:e,useAltStyle:t%2!==0,onKeyUpdated:Q})}))}function Q(e){W(L+1),b(e)}return q?r.a.createElement("span",null,"Error response from server: ",q,". Please refresh the page."):m?r.a.createElement("span",null,"Loading..."):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Hello, ",null===(t=s.user)||void 0===t?void 0:t.name," [",null===(n=s.user)||void 0===n?void 0:n.id,"] ",r.a.createElement("a",{href:"#",className:O.a.lockAnchor,onClick:function(e){e.preventDefault(),o()}},"Lock")),r.a.createElement("table",{className:O.a.root},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Description"),r.a.createElement("th",null,"Created"),r.a.createElement("th",null,"Actions"))),r.a.createElement("tbody",null,G(J)),M.length>0&&r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",checked:g,onChange:function(e){return j(e.target.checked)}}),"\xa0Show revoked keys (",M.length,")"))),g&&G(M))),r.a.createElement("div",null,r.a.createElement("h3",null,"New key"),r.a.createElement("form",{action:"",onSubmit:function(e){return H.apply(this,arguments)}},r.a.createElement("input",{type:"text",placeholder:"Description",value:N,onChange:function(e){return R(e.target.value)},disabled:T}),r.a.createElement("input",{type:"submit",value:"Create key",disabled:T}),T&&r.a.createElement("span",null,"creating key..."))))},g=n(6),j=n.n(g),A=function(e){var t=e.question,n=e.answer,a=e.children;return r.a.createElement("div",{className:j.a.root},r.a.createElement("p",{className:j.a.question},t),n&&r.a.createElement("p",null,n),!n&&a)};var S=function(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],o=t[1],s={serverBaseUrl:"https://torn-proxy.com",user:n};return Object(a.useEffect)((function(){Object(i.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(s.serverBaseUrl+"/api/me",{credentials:"include"});case 2:if(200!==(t=e.sent).status){e.next=8;break}return e.next=6,t.json();case 6:n=e.sent,o(n);case 8:case"end":return e.stop()}}),e)})))()}),[]),r.a.createElement(k.Provider,{value:s},r.a.createElement("div",{className:d.a.root},r.a.createElement("h1",null,"TORN proxy"),r.a.createElement("p",null,"The only place that needs to know your TORN API key."),r.a.createElement("p",null,"Apps can use dedicated proxy keys to make requests to the TORN API."),r.a.createElement("p",null,"Easy app-based access control for added privacy and security."),r.a.createElement("h2",null,"My proxy keys"),null===n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Locked. Enter your TORN API key first."),r.a.createElement(h,{onAuthenticated:o})),null!==n&&r.a.createElement(_,{onLock:function(){o(null),fetch(s.serverBaseUrl+"/api/lock",{credentials:"include",method:"post"})}}),null===n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"FAQ"),r.a.createElement(A,{question:"Why?",answer:"TORN is not going to support multiple API keys. We feel privacy should be top of mind for everyone."}),r.a.createElement(A,{question:"Okay, but how?",answer:"Instead of giving out your single TORN API key to apps, you create a new proxy key and use that instead. Want to stop using said app? Then simply revoke the key and the app will longer have access. No more need to reset your TORN API key."}),r.a.createElement(A,{question:"Why trust you?"},r.a.createElement("p",null,"I highly value security and privacy. Ched's rejection of my ",r.a.createElement("a",{href:"https://www.torn.com/forums.php#/p=threads&f=19&t=16177140",target:"_blank",rel:"noopener noreferrer"},"[100R+] API keys suggestion")," triggered this proxy idea. If you're an ArsonWarehouse user, I already have your TORN API key. I never have, and never will, abuse it. Better to trust a single party than a whole range of apps and sites.")),r.a.createElement(A,{question:"Okay, but what about leaks?",answer:"Your TORN key is encrypted before it's stored. If the database is ever accessed by a third party, they can see your proxy keys but not your TORN key. If ever does leak I'll be transparent about it so you can take action."}),r.a.createElement(A,{question:"Why are proxy keys not encrypted?",answer:"To keep the proxy service as fast as possible. With every request, I need to look up the TORN key that belongs to the given proxy key and forward the request to TORN. I need to be able to efficiently query the proxy keys table."}),r.a.createElement(A,{question:"Roadmap?",answer:"I plan on adding permissions. Simple ones at first, separating public from private data. That way, apps can use your key to fetch market info but not sensitive data such as battle stats."}),r.a.createElement(A,{question:"I'm a developer, how do I implement this?"},"Check out the ",r.a.createElement("a",{href:"https://github.com/sulsay/torn-proxy",target:"_blank",rel:"noopener noreferrer"},"source code")," and the readme.md in the root for instructions."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[11,1,2]]]);
//# sourceMappingURL=main.225154e9.chunk.js.map